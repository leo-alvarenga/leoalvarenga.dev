---
import { Icon } from "astro-icon/components";

import TechnologyBadge from "../../../TechnologyBadge.astro";
import { getLangFromUrl, useTranslation } from "../../../../config";
import type { Xp } from "../../../../data";
import { formatDate, translatableTextToString } from "../../../../utils";

interface Props {
  toggleable?: boolean;
  xp: Xp;
}

const { toggleable, xp } = Astro.props;
const [language] = getLangFromUrl(Astro.url);
const { t } = useTranslation({ language });

const { company, description, icon, position, stack } = xp;
const { location, name, page } = company;
---

<div
  class={`
    flex items-center gap-12
    w-full border-l border-l-red
    pl-8 py-4 relative
    ${toggleable ? "hidden" : ""}
  `}
  data-xptoggleable={String(toggleable || false)}
>
  <span
    class="absolute left-[-14px] border-2 aspect-square flex items-center justify-center rotate-45 border-red p-1 rounded-md text-xs bg-crust"
  >
    <Icon class="-rotate-45" name={icon} />
  </span>

  <div
    class={`
        flex flex-col w-full
        gap-6 items-start
        bg-crust p-4
        rounded-lg
      `}
  >
    <hgroup class="flex flex-col gap-2 w-full items-start">
      <div
        class={`
          flex flex-col
          items-start gap-2
          lg:flex-row lg:gap-4
          lg:items-center lg:justify-between  
          w-full text-xl
        `}
      >
        <h4>
          <span class="font-bold">
            {translatableTextToString(position, language)}
          </span>

          {name && <span>@{translatableTextToString(name, language)}</span>}
        </h4>

        <span class="italic">
          {formatDate(xp, language, "commons.present")}
        </span>
      </div>

      <span
        class={`
          flex gap-4 items-center
          w-full text-start
          text-sm text-subtext-1
        `}
      >
        <h5 class="inline-default">
          <Icon class="text-mauve" name="fa6-solid:location-dot" />

          <span>
            {
              location
                ? translatableTextToString(location, language)
                : t("commons.location.remote")
            }
          </span>
        </h5>

        {
          page && (
            <a
              class="inline-default duration-200 transition-all hover:text-mauve"
              href={page}
            >
              <span class="underline">{page.split("//")[1]}</span>

              <Icon name="fa6-solid:arrow-up-right-from-square" />
            </a>
          )
        }
      </span>
    </hgroup>

    <p class="text-subtext-1">
      {translatableTextToString(description, language)}
    </p>

    <div class="flex gap-2 flex-wrap items-center justify-start">
      {
        stack.map((tech) => (
          <TechnologyBadge tech={tech} enableBorder />
        ))
      }
    </div>
  </div>
</div>
