---
import { Icon } from "astro-icon/components";

import { CONTACTS } from "../../../../data";

import { getLangFromUrl, useTranslation } from "../../../../config";
import { EMAIL_FOR_CONTACT } from "../../../../utils";

const [language] = getLangFromUrl(Astro.url);
const { t } = useTranslation({ language });

const contactClasses = {
  anchor: `
    cursor-pointer flex flex-row
    gap-2 items-center justify-center
    px-4 py-1 border flex-1
    border-green group
    
    active:bg-green
    hover:bg-green

    active:text-crust
    hover:text-crust

    duration-250 transition-all
  `,
  preffix: `
    text-crust
    max-w-0 overflow-hidden
    duration-250 transition-all
    group-active:max-w-12
    group-hover:max-w-12
  `,
  text: "text-center",
};
---

<div class="flex flex-col gap-4 w-full">
  <button
    class={contactClasses.anchor}
    data-email={EMAIL_FOR_CONTACT}
    id="email-action"
  >
    <span class={contactClasses.preffix}>
      <Icon name="fa6-solid:copy" />
    </span>

    <span id="email-action-text" class={contactClasses.text}>
      {t("home.titlecard.email.action")}
    </span>

    <Icon name="fa6-solid:envelope" />
  </button>

  <div class="flex flex-row flex-wrap items-center w-full gap-4">
    {
      CONTACTS.map(({ href, icon, label }) => (
        <a class={contactClasses.anchor} href={href} target="_blank">
          <span class={`${contactClasses.text} group-hover:underline`}>
            {t(label)}
          </span>

          <i class={icon} />
        </a>
      ))
    }
  </div>
</div>

<script lang="js">
  function handleEmailAction({ target }) {
    const email = target.getAttribute("data-email");

    navigator.clipboard.writeText(String(email));
  }

  function setup() {
    const emailtToBtn = document.getElementById("email-action");

    if (!emailtToBtn) {
      console.error(
        "Email action is not currently avaible. Only redirecting will work"
      );

      return;
    }

    emailtToBtn.addEventListener("click", handleEmailAction, false);
  }

  setup();
</script>
